@startuml 03-AI매물검증
!theme mono

title UF03: AI 기반 매물 종합 검증

actor "사용자\n(사회초년생/신혼부부)" as User
participant "검증 시스템" as System
participant "AI/ML 모델" as AIModel
participant "부동산 DB API" as EstateDB
participant "공공데이터 API" as PublicAPI
participant "알림 서비스" as NotificationSVC
database "검증 결과 저장소" as DB

== 이벤트: 매물 정보 입력 ==

User -> System : **커맨드**: 매물 정보 입력하기\n데이터: 주소, 가격, 면적, 매물유형
activate System
System -> System : **이벤트**: 매물 정보 입력됨\n데이터: 기본정보
note right
  **기본 입력 항목**
  • 주소 (시/구/동)
  • 매물 유형 (월세/전세/매매)
  • 가격 (보증금/월세/매매가)
  • 면적 (전용/공급)
end note

alt 상세 정보 추가
    User -> System : **커맨드**: 상세 정보 추가하기\n데이터: 건축연도, 층수, 방향, 옵션
    System -> System : **이벤트**: 추가 정보 수집됨\n데이터: 상세정보
    note right
      **상세 정보**
      • 건축 연도, 층수, 방향
      • 엘리베이터, 주차장
      • 옵션 (에어컨, 냉장고 등)
      • 특이사항
    end note
end

== 이벤트: AI 분석 요청 ==

User -> System : **커맨드**: AI 검증 요청하기
System -> System : **이벤트**: AI 분석 요청됨

== 이벤트: 시세 적정성 분석 ==

System -> EstateDB : 주변 시세 정보 조회\n(반경 1km 이내 거래내역)
activate EstateDB
EstateDB --> System : 실거래가 데이터
deactivate EstateDB

System -> AIModel : 시세 적정성 분석 요청
activate AIModel
AIModel -> AIModel : 주변 시세 비교 분석
AIModel --> System : **이벤트**: 시세 적정성 분석됨\n데이터: 주변시세, 가격적정도
deactivate AIModel

note right
  **Policy/Rule**
  - 시세 대비 ±10% 이내: 적정
  - 시세 대비 +10~20%: 주의
  - 시세 대비 +20% 이상: 경고
  - 시세 대비 -20% 이상: 이상 거래 의심
end note

alt 시세 대비 20% 이상 차이
    System -> User : ⚠️ 경고: 시세 이상 거래 의심
    note right
      **리스크 알림**
      주변 시세와 큰 차이가 있습니다.
      추가 확인이 필요합니다.
    end note
end

== 이벤트: 입지 분석 ==

System -> PublicAPI : 공공데이터 조회\n(교통, 편의시설, 학군)
activate PublicAPI
PublicAPI --> System : 입지 관련 데이터
deactivate PublicAPI

System -> AIModel : 입지 종합 분석 요청
activate AIModel
AIModel -> AIModel : 입지 점수 계산
AIModel --> System : **이벤트**: 입지 분석 완료됨\n데이터: 교통접근성, 편의시설, 학군
deactivate AIModel

note right
  **Policy/Rule - 입지 점수 계산**
  • 지하철역 500m 이내: +20점
  • 버스정류장 200m 이내: +10점
  • 대형마트 1km 이내: +10점
  • 초등학교 500m 이내: +15점
  • 공원 500m 이내: +10점

  **평가 기준**
  • 80점 이상: 우수
  • 60-79점: 양호
  • 40-59점: 보통
  • 40점 미만: 개선 필요
end note

== 이벤트: 리스크 요소 탐지 ==

System -> EstateDB : 법적 이슈 조회\n(재개발, 소송, 압류 등)
activate EstateDB
EstateDB --> System : 법적 상태 정보
deactivate EstateDB

System -> AIModel : 리스크 분석 요청
activate AIModel
AIModel -> AIModel : 종합 리스크 평가
AIModel --> System : **이벤트**: 리스크 요소 탐지됨\n데이터: 법적이슈, 재개발여부, 하자이력
deactivate AIModel

note right
  **Policy/Rule - 리스크 등급**
  • 법적 이슈 발견 시: 즉시 알림
  • 재개발 예정 지역: 주의 표시
  • 오래된 건물 (30년 이상): 안전 점검 권장
  • 하자 이력 있음: 상세 조사 필요
end note

alt 법적 이슈 발견
    System -> NotificationSVC : 긴급 알림 발송
    activate NotificationSVC
    NotificationSVC -> User : 🚨 긴급: 법적 이슈 발견
    deactivate NotificationSVC
    note right
      **즉시 알림 필요 사항**
      • 압류, 가압류
      • 소송 계류 중
      • 불법 건축물
    end note
end

== 이벤트: 종합 검증 결과 생성 ==

System -> AIModel : 종합 평가 요청
activate AIModel
AIModel -> AIModel : 종합 점수 계산
AIModel --> System : **이벤트**: 종합 검증 결과 생성됨\n데이터: 종합점수, 장단점, 주의사항
deactivate AIModel

note right
  **종합 점수 구성**
  • 시세 적정성: 30%
  • 입지 점수: 40%
  • 리스크 평가: 30%

  **Policy/Rule**
  • 종합 점수 80점 이상: 추천
  • 60-79점: 긍정적
  • 40-59점: 보통
  • 60점 미만: 재검토 권장
end note

System --> User : 검증 결과 제공\n(점수, 장단점, 주의사항, 추천여부)

== 이벤트: 리스크 알림 및 저장 ==

alt 종합 점수 60점 미만 또는 리스크 발견
    System -> NotificationSVC : 리스크 알림 발송
    activate NotificationSVC
    System -> System : **이벤트**: 리스크 알림 발송됨
    NotificationSVC -> User : 📱 알림: 주의사항 확인 필요
    deactivate NotificationSVC
end

User -> System : **커맨드**: 검증 결과 저장 확인
System -> DB : 검증 결과 저장
activate DB
System -> System : **이벤트**: 검증 결과 저장됨\n데이터: 검증ID, 매물정보, 분석결과
DB --> System : 저장 완료
deactivate DB
deactivate System

System --> User : 검증 완료 (결과 저장됨)

note over User, DB
  **주요 데이터 흐름**
  • 입력: 매물 기본정보, 상세정보
  • 외부 연동: 부동산DB, AI모델, 공공데이터
  • 분석: 시세적정성, 입지, 리스크
  • 출력: 종합점수, 장단점, 주의사항
  • 알림: 리스크 발견 시 즉시 통지

  **다음 플로우 연결**
  • UF01로 전달: 실제 매물 정보 (비용 재계산)
  • UF02에서 참조: 목표 매물 조건
  • UF01에서 재검증: 가격 협상 후 재분석
end note

@enduml
