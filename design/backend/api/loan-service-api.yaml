openapi: 3.0.3
info:
  title: Loan Service API
  description: |
    대출상품 정보 관리 서비스 API
    - 사용자: 대출상품 목록/상세 조회, 필터링/정렬/검색
    - 관리자: 대출상품 등록/수정/삭제
  version: 1.0.0
  contact:
    name: Backend Team
    email: backend@homehelper.com

servers:
  - url: https://virtserver.swaggerhub.com/homehelper/loan-service/1.0.0
    description: SwaggerHub Mock Server
  - url: http://localhost:8083/api/v1
    description: Local Development Server
  - url: https://api.homehelper.com/loan-service/api/v1
    description: Production Server

tags:
  - name: Loan Product
    description: 대출상품 관리 API
  - name: Admin
    description: 관리자 전용 API

paths:
  /loans:
    get:
      tags:
        - Loan Product
      summary: 대출상품 목록 조회
      description: |
        이용 가능한 대출상품 목록을 필터링, 정렬, 검색하여 조회합니다.
        - 대상주택 유형별 필터링
        - 금리순/한도순 정렬
        - 대출이름, 대상주택 검색
      operationId: getLoanProducts
      x-user-story: UFR-LOAN-010
      x-controller: LoanProductController
      parameters:
        - name: housingType
          in: query
          description: 대상주택 유형 필터 (전체/아파트/빌라/주택)
          required: false
          schema:
            type: string
            enum: [ALL, APARTMENT, VILLA, HOUSE]
            default: ALL
          example: APARTMENT
        - name: sortBy
          in: query
          description: 정렬 기준
          required: false
          schema:
            type: string
            enum: [INTEREST_RATE, LOAN_LIMIT, CREATED_AT]
            default: CREATED_AT
          example: INTEREST_RATE
        - name: sortOrder
          in: query
          description: 정렬 순서
          required: false
          schema:
            type: string
            enum: [ASC, DESC]
            default: ASC
          example: ASC
        - name: keyword
          in: query
          description: 검색 키워드 (대출이름, 대상주택)
          required: false
          schema:
            type: string
            maxLength: 100
          example: 신혼부부
        - name: page
          in: query
          description: 페이지 번호 (0부터 시작)
          required: false
          schema:
            type: integer
            minimum: 0
            default: 0
          example: 0
        - name: size
          in: query
          description: 페이지당 항목 수
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
          example: 20
      responses:
        '200':
          description: 대출상품 목록 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoanProductListResponse'
              example:
                success: true
                data:
                  content:
                    - id: 1
                      name: 신혼부부 특별대출
                      loanLimit: 300000000
                      ltvLimit: 70.0
                      dtiLimit: 60.0
                      dsrLimit: 40.0
                      interestRate: 2.5
                      targetHousing: 6억 이하 아파트
                      incomeRequirement: 부부합산 연소득 7천만원 이하
                      applicantRequirement: 무주택 신혼부부
                      remarks: null
                      active: true
                      createdAt: "2025-01-15T10:00:00"
                      updatedAt: "2025-01-15T10:00:00"
                    - id: 2
                      name: 생애최초 구입자금대출
                      loanLimit: 400000000
                      ltvLimit: 80.0
                      dtiLimit: 60.0
                      dsrLimit: 40.0
                      interestRate: 3.0
                      targetHousing: 9억 이하 주택
                      incomeRequirement: 연소득 8천만원 이하
                      applicantRequirement: 생애최초 주택 구입자
                      remarks: null
                      active: true
                      createdAt: "2025-01-14T09:00:00"
                      updatedAt: "2025-01-14T09:00:00"
                  pageable:
                    pageNumber: 0
                    pageSize: 20
                    totalElements: 2
                    totalPages: 1
                message: 대출상품 목록 조회 성공
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []

    post:
      tags:
        - Admin
      summary: 대출상품 등록 (관리자)
      description: 새로운 대출상품을 등록합니다. 관리자 권한 필요.
      operationId: createLoanProduct
      x-user-story: AFR-LOAN-030
      x-controller: LoanProductAdminController
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateLoanProductRequest'
            example:
              name: 청년우대형 주택대출
              loanLimit: 250000000
              ltvLimit: 70.0
              dtiLimit: 50.0
              dsrLimit: 40.0
              interestRate: 2.8
              targetHousing: 5억 이하 아파트/주택
              incomeRequirement: 만 19세~34세, 연소득 5천만원 이하
              applicantRequirement: 무주택 청년
              remarks: 우대금리 적용 가능
      responses:
        '201':
          description: 대출상품 등록 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoanProductResponse'
              example:
                success: true
                data:
                  id: 3
                  name: 청년우대형 주택대출
                  loanLimit: 250000000
                  ltvLimit: 70.0
                  dtiLimit: 50.0
                  dsrLimit: 40.0
                  interestRate: 2.8
                  targetHousing: 5억 이하 아파트/주택
                  incomeRequirement: 만 19세~34세, 연소득 5천만원 이하
                  applicantRequirement: 무주택 청년
                  remarks: 우대금리 적용 가능
                  active: true
                  createdAt: "2025-01-20T14:30:00"
                  updatedAt: "2025-01-20T14:30:00"
                message: 대출상품 등록 성공
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: [ROLE_ADMIN]

  /loans/{id}:
    get:
      tags:
        - Loan Product
      summary: 대출상품 상세 조회
      description: |
        특정 대출상품의 상세 정보를 조회합니다.
        - 모든 기본정보 및 자격요건
        - LTV/DTI/DSR 한도 정보
        - 신청 방법 안내
      operationId: getLoanProductDetail
      x-user-story: UFR-LOAN-020
      x-controller: LoanProductController
      parameters:
        - name: id
          in: path
          description: 대출상품 ID
          required: true
          schema:
            type: integer
            format: int64
          example: 1
      responses:
        '200':
          description: 대출상품 상세 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoanProductResponse'
              example:
                success: true
                data:
                  id: 1
                  name: 신혼부부 특별대출
                  loanLimit: 300000000
                  ltvLimit: 70.0
                  dtiLimit: 60.0
                  dsrLimit: 40.0
                  interestRate: 2.5
                  targetHousing: 6억 이하 아파트
                  incomeRequirement: 부부합산 연소득 7천만원 이하
                  applicantRequirement: 무주택 신혼부부
                  remarks: 결혼 7년 이내 신혼부부 대상
                  active: true
                  createdAt: "2025-01-15T10:00:00"
                  updatedAt: "2025-01-15T10:00:00"
                message: 대출상품 상세 조회 성공
        '400':
          $ref: '#/components/responses/BadRequest'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: []

    put:
      tags:
        - Admin
      summary: 대출상품 수정 (관리자)
      description: 기존 대출상품 정보를 수정합니다. 관리자 권한 필요.
      operationId: updateLoanProduct
      x-user-story: AFR-LOAN-030
      x-controller: LoanProductAdminController
      parameters:
        - name: id
          in: path
          description: 대출상품 ID
          required: true
          schema:
            type: integer
            format: int64
          example: 1
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateLoanProductRequest'
            example:
              name: 신혼부부 특별대출
              loanLimit: 350000000
              ltvLimit: 75.0
              dtiLimit: 60.0
              dsrLimit: 40.0
              interestRate: 2.3
              targetHousing: 6억 이하 아파트
              incomeRequirement: 부부합산 연소득 8천만원 이하
              applicantRequirement: 무주택 신혼부부
              remarks: 결혼 7년 이내 신혼부부 대상, 금리 인하 적용
              active: true
      responses:
        '200':
          description: 대출상품 수정 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoanProductResponse'
              example:
                success: true
                data:
                  id: 1
                  name: 신혼부부 특별대출
                  loanLimit: 350000000
                  ltvLimit: 75.0
                  dtiLimit: 60.0
                  dsrLimit: 40.0
                  interestRate: 2.3
                  targetHousing: 6억 이하 아파트
                  incomeRequirement: 부부합산 연소득 8천만원 이하
                  applicantRequirement: 무주택 신혼부부
                  remarks: 결혼 7년 이내 신혼부부 대상, 금리 인하 적용
                  active: true
                  createdAt: "2025-01-15T10:00:00"
                  updatedAt: "2025-01-20T15:30:00"
                message: 대출상품 수정 성공
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: [ROLE_ADMIN]

    delete:
      tags:
        - Admin
      summary: 대출상품 삭제 (관리자)
      description: |
        대출상품을 삭제합니다. 관리자 권한 필요.
        - 사용 중인 대출상품은 삭제할 수 없음 (경고)
        - 소프트 삭제 적용 (active = false)
      operationId: deleteLoanProduct
      x-user-story: AFR-LOAN-030
      x-controller: LoanProductAdminController
      parameters:
        - name: id
          in: path
          description: 대출상품 ID
          required: true
          schema:
            type: integer
            format: int64
          example: 3
      responses:
        '200':
          description: 대출상품 삭제 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ApiResponse'
              example:
                success: true
                data: null
                message: 대출상품이 삭제되었습니다
        '400':
          description: 삭제 불가능 (사용 중)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                success: false
                error:
                  code: LOAN_PRODUCT_IN_USE
                  message: 현재 사용 중인 대출상품은 삭제할 수 없습니다
                  details:
                    - field: id
                      message: 3개의 계산 결과에서 사용 중
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/InternalServerError'
      security:
        - bearerAuth: [ROLE_ADMIN]

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: |
        JWT 토큰 인증
        - 일반 사용자: 조회 API 접근 가능
        - 관리자: 모든 API 접근 가능

  schemas:
    LoanProductListResponse:
      type: object
      required:
        - success
        - data
        - message
      properties:
        success:
          type: boolean
          description: 응답 성공 여부
        data:
          type: object
          required:
            - content
            - pageable
          properties:
            content:
              type: array
              description: 대출상품 목록
              items:
                $ref: '#/components/schemas/LoanProductDTO'
            pageable:
              $ref: '#/components/schemas/PageInfo'
        message:
          type: string
          description: 응답 메시지

    LoanProductResponse:
      type: object
      required:
        - success
        - data
        - message
      properties:
        success:
          type: boolean
          description: 응답 성공 여부
        data:
          $ref: '#/components/schemas/LoanProductDTO'
        message:
          type: string
          description: 응답 메시지

    LoanProductDTO:
      type: object
      required:
        - id
        - name
        - loanLimit
        - ltvLimit
        - dtiLimit
        - dsrLimit
        - interestRate
        - targetHousing
        - active
        - createdAt
        - updatedAt
      properties:
        id:
          type: integer
          format: int64
          description: 대출상품 ID
          example: 1
        name:
          type: string
          maxLength: 100
          description: 대출이름
          example: 신혼부부 특별대출
        loanLimit:
          type: integer
          format: int64
          minimum: 0
          description: 대출한도 (원)
          example: 300000000
        ltvLimit:
          type: number
          format: double
          minimum: 0
          maximum: 100
          description: LTV 한도 (%)
          example: 70.0
        dtiLimit:
          type: number
          format: double
          minimum: 0
          maximum: 100
          description: DTI 한도 (%)
          example: 60.0
        dsrLimit:
          type: number
          format: double
          minimum: 0
          maximum: 100
          description: DSR 한도 (%)
          example: 40.0
        interestRate:
          type: number
          format: double
          minimum: 0
          description: 금리 (연 %)
          example: 2.5
        targetHousing:
          type: string
          maxLength: 200
          description: 대상주택
          example: 6억 이하 아파트
        incomeRequirement:
          type: string
          maxLength: 500
          description: 소득요건
          nullable: true
          example: 부부합산 연소득 7천만원 이하
        applicantRequirement:
          type: string
          maxLength: 500
          description: 신청자요건
          nullable: true
          example: 무주택 신혼부부
        remarks:
          type: string
          maxLength: 1000
          description: 비고
          nullable: true
          example: 결혼 7년 이내 신혼부부 대상
        active:
          type: boolean
          description: 활성화 여부
          example: true
        createdAt:
          type: string
          format: date-time
          description: 등록일시
          example: "2025-01-15T10:00:00"
        updatedAt:
          type: string
          format: date-time
          description: 수정일시
          example: "2025-01-15T10:00:00"

    CreateLoanProductRequest:
      type: object
      required:
        - name
        - loanLimit
        - ltvLimit
        - dtiLimit
        - dsrLimit
        - interestRate
        - targetHousing
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: 대출이름
          example: 청년우대형 주택대출
        loanLimit:
          type: integer
          format: int64
          minimum: 1
          description: 대출한도 (원)
          example: 250000000
        ltvLimit:
          type: number
          format: double
          minimum: 0
          maximum: 100
          description: LTV 한도 (%)
          example: 70.0
        dtiLimit:
          type: number
          format: double
          minimum: 0
          maximum: 100
          description: DTI 한도 (%)
          example: 50.0
        dsrLimit:
          type: number
          format: double
          minimum: 0
          maximum: 100
          description: DSR 한도 (%)
          example: 40.0
        interestRate:
          type: number
          format: double
          minimum: 0
          description: 금리 (연 %)
          example: 2.8
        targetHousing:
          type: string
          minLength: 1
          maxLength: 200
          description: 대상주택
          example: 5억 이하 아파트/주택
        incomeRequirement:
          type: string
          maxLength: 500
          description: 소득요건 (선택)
          nullable: true
          example: 만 19세~34세, 연소득 5천만원 이하
        applicantRequirement:
          type: string
          maxLength: 500
          description: 신청자요건 (선택)
          nullable: true
          example: 무주택 청년
        remarks:
          type: string
          maxLength: 1000
          description: 비고 (선택)
          nullable: true
          example: 우대금리 적용 가능

    UpdateLoanProductRequest:
      type: object
      required:
        - name
        - loanLimit
        - ltvLimit
        - dtiLimit
        - dsrLimit
        - interestRate
        - targetHousing
        - active
      properties:
        name:
          type: string
          minLength: 1
          maxLength: 100
          description: 대출이름
          example: 신혼부부 특별대출
        loanLimit:
          type: integer
          format: int64
          minimum: 1
          description: 대출한도 (원)
          example: 350000000
        ltvLimit:
          type: number
          format: double
          minimum: 0
          maximum: 100
          description: LTV 한도 (%)
          example: 75.0
        dtiLimit:
          type: number
          format: double
          minimum: 0
          maximum: 100
          description: DTI 한도 (%)
          example: 60.0
        dsrLimit:
          type: number
          format: double
          minimum: 0
          maximum: 100
          description: DSR 한도 (%)
          example: 40.0
        interestRate:
          type: number
          format: double
          minimum: 0
          description: 금리 (연 %)
          example: 2.3
        targetHousing:
          type: string
          minLength: 1
          maxLength: 200
          description: 대상주택
          example: 6억 이하 아파트
        incomeRequirement:
          type: string
          maxLength: 500
          description: 소득요건 (선택)
          nullable: true
          example: 부부합산 연소득 8천만원 이하
        applicantRequirement:
          type: string
          maxLength: 500
          description: 신청자요건 (선택)
          nullable: true
          example: 무주택 신혼부부
        remarks:
          type: string
          maxLength: 1000
          description: 비고 (선택)
          nullable: true
          example: 결혼 7년 이내 신혼부부 대상, 금리 인하 적용
        active:
          type: boolean
          description: 활성화 여부
          example: true

    PageInfo:
      type: object
      required:
        - pageNumber
        - pageSize
        - totalElements
        - totalPages
      properties:
        pageNumber:
          type: integer
          description: 현재 페이지 번호 (0부터 시작)
          example: 0
        pageSize:
          type: integer
          description: 페이지당 항목 수
          example: 20
        totalElements:
          type: integer
          format: int64
          description: 전체 항목 수
          example: 2
        totalPages:
          type: integer
          description: 전체 페이지 수
          example: 1

    ApiResponse:
      type: object
      required:
        - success
        - message
      properties:
        success:
          type: boolean
          description: 응답 성공 여부
        data:
          type: object
          description: 응답 데이터 (nullable)
          nullable: true
        message:
          type: string
          description: 응답 메시지

    ErrorResponse:
      type: object
      required:
        - success
        - error
      properties:
        success:
          type: boolean
          description: 응답 성공 여부 (항상 false)
          example: false
        error:
          type: object
          required:
            - code
            - message
          properties:
            code:
              type: string
              description: 에러 코드
              example: VALIDATION_ERROR
            message:
              type: string
              description: 에러 메시지
              example: 입력값 검증 실패
            details:
              type: array
              description: 상세 에러 정보
              items:
                type: object
                properties:
                  field:
                    type: string
                    description: 필드명
                  message:
                    type: string
                    description: 필드 에러 메시지

  responses:
    BadRequest:
      description: 잘못된 요청
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: VALIDATION_ERROR
              message: 입력값 검증 실패
              details:
                - field: loanLimit
                  message: 대출한도는 1 이상이어야 합니다
                - field: interestRate
                  message: 금리는 0 이상이어야 합니다

    Unauthorized:
      description: 인증 실패
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: UNAUTHORIZED
              message: 인증이 필요합니다

    Forbidden:
      description: 권한 없음
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: FORBIDDEN
              message: 관리자 권한이 필요합니다

    NotFound:
      description: 리소스를 찾을 수 없음
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: NOT_FOUND
              message: 대출상품을 찾을 수 없습니다

    InternalServerError:
      description: 서버 내부 오류
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            success: false
            error:
              code: INTERNAL_SERVER_ERROR
              message: 서버 오류가 발생했습니다
