openapi: 3.0.0
info:
  title: Calculator Service API
  description: 재무 계산 및 결과 관리 서비스 API
  version: 1.0.0
  contact:
    name: Calculator Service Team

servers:
  - url: https://api.home-starter.com/calculator/v1
    description: Production server
  - url: https://virtserver.swaggerhub.com/home-starter/calculator/1.0.0
    description: SwaggerHub Mock server

security:
  - bearerAuth: []

tags:
  - name: Calculator
    description: 재무 계산
  - name: Results
    description: 계산 결과 관리

paths:
  /calculator/housing-expenses:
    post:
      summary: 입주 후 지출 계산
      description: 주택 구입 후 재무 상태를 계산합니다
      operationId: calculateHousingExpenses
      x-user-story: UFR-CALC-010
      x-controller: CalculatorController
      tags:
        - Calculator
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/HousingExpensesRequest'
            example:
              housingId: "housing-uuid-001"
              loanProductId: "loan-uuid-001"
              loanAmount: 600000000
              loanTerm: 360
      responses:
        '201':
          description: 계산 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalculationResultResponse'
              example:
                id: "calc-uuid-001"
                userId: "user-uuid-001"
                housingId: "housing-uuid-001"
                housingName: "래미안 강남 퍼스티지"
                loanProductId: "loan-uuid-001"
                loanProductName: "신혼부부 특별대출"
                calculatedAt: "2024-12-20T15:30:00Z"
                financialStatus:
                  currentAssets: 300000000
                  estimatedAssets: 350000000
                  loanRequired: 500000000
                loanAnalysis:
                  ltv: 58.82
                  dti: 35.5
                  dsr: 40.2
                  ltvLimit: 70.0
                  dtiLimit: 40.0
                  dsrLimit: 50.0
                  isEligible: true
                  ineligibilityReasons: []
                  monthlyPayment: 2500000
                afterMoveIn:
                  assets: 350000000
                  monthlyExpenses: 4500000
                  monthlyIncome: 6000000
                  availableFunds: 1500000
                status: "ELIGIBLE"
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          description: 주택 또는 대출상품을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'

  /calculator/results:
    get:
      summary: 계산 결과 목록 조회
      description: 저장된 모든 계산 결과 목록을 조회합니다
      operationId: getCalculationResults
      x-user-story: UFR-CALC-020
      x-controller: CalculatorController
      tags:
        - Results
      parameters:
        - name: housingId
          in: query
          description: 주택 ID 필터
          schema:
            type: string
        - name: status
          in: query
          description: 충족 여부 필터
          schema:
            type: string
            enum: [ELIGIBLE, INELIGIBLE]
        - name: sortBy
          in: query
          description: 정렬 기준
          schema:
            type: string
            enum: [calculatedAt, availableFunds]
            default: calculatedAt
        - name: sortOrder
          in: query
          description: 정렬 순서
          schema:
            type: string
            enum: [asc, desc]
            default: desc
        - name: page
          in: query
          description: 페이지 번호 (0부터 시작)
          schema:
            type: integer
            default: 0
        - name: size
          in: query
          description: 페이지 크기
          schema:
            type: integer
            default: 20
            maximum: 100
      responses:
        '200':
          description: 계산 결과 목록 조회 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  results:
                    type: array
                    items:
                      $ref: '#/components/schemas/CalculationResultListItem'
                  page:
                    type: integer
                  size:
                    type: integer
                  total:
                    type: integer
              example:
                results:
                  - id: "calc-uuid-001"
                    housingName: "래미안 강남 퍼스티지"
                    loanProductName: "신혼부부 특별대출"
                    calculatedAt: "2024-12-20T15:30:00Z"
                    status: "ELIGIBLE"
                    availableFunds: 1500000
                  - id: "calc-uuid-002"
                    housingName: "힐스테이트 용산"
                    loanProductName: "일반주택담보대출"
                    calculatedAt: "2024-12-19T10:20:00Z"
                    status: "INELIGIBLE"
                    availableFunds: -500000
                page: 0
                size: 20
                total: 2
        '401':
          $ref: '#/components/responses/Unauthorized'

  /calculator/results/{id}:
    get:
      summary: 계산 결과 상세 조회
      description: 특정 계산 결과의 상세 정보를 조회합니다
      operationId: getCalculationResult
      x-user-story: UFR-CALC-020
      x-controller: CalculatorController
      tags:
        - Results
      parameters:
        - name: id
          in: path
          required: true
          description: 계산 결과 ID
          schema:
            type: string
      responses:
        '200':
          description: 계산 결과 조회 성공
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CalculationResultResponse'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      summary: 계산 결과 삭제
      description: 계산 결과를 삭제합니다
      operationId: deleteCalculationResult
      x-user-story: UFR-CALC-020
      x-controller: CalculatorController
      tags:
        - Results
      parameters:
        - name: id
          in: path
          required: true
          description: 계산 결과 ID
          schema:
            type: string
      responses:
        '204':
          description: 삭제 성공
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT 토큰을 사용한 인증

  schemas:
    HousingExpensesRequest:
      type: object
      required:
        - housingId
        - loanProductId
        - loanAmount
        - loanTerm
      properties:
        housingId:
          type: string
          description: 주택 ID
        loanProductId:
          type: string
          description: 대출상품 ID
        loanAmount:
          type: integer
          format: int64
          description: 대출 금액 (원)
        loanTerm:
          type: integer
          description: 대출 기간 (개월)

    FinancialStatus:
      type: object
      description: 재무 현황
      properties:
        currentAssets:
          type: integer
          format: int64
          description: 현재 순자산 (원)
        estimatedAssets:
          type: integer
          format: int64
          description: 입주희망년월 기준 예상자산 (원)
        loanRequired:
          type: integer
          format: int64
          description: 대출필요 금액 (원)

    LoanAnalysis:
      type: object
      description: 대출 분석
      properties:
        ltv:
          type: number
          format: double
          description: 계산된 LTV (%)
        dti:
          type: number
          format: double
          description: 계산된 DTI (%)
        dsr:
          type: number
          format: double
          description: 계산된 DSR (%)
        ltvLimit:
          type: number
          format: double
          description: 대출상품 LTV 한도 (%)
        dtiLimit:
          type: number
          format: double
          description: 대출상품 DTI 한도 (%)
        dsrLimit:
          type: number
          format: double
          description: 대출상품 DSR 한도 (%)
        isEligible:
          type: boolean
          description: 대출상품 기준 충족 여부
        ineligibilityReasons:
          type: array
          description: 미충족 시 상세 사유
          items:
            type: string
          example:
            - "LTV 한도 초과 (계산: 75%, 한도: 70%)"
            - "DTI 한도 초과 (계산: 45%, 한도: 40%)"
        monthlyPayment:
          type: integer
          format: int64
          description: 월 대출상환액 (원)

    AfterMoveIn:
      type: object
      description: 입주 후 재무상태
      properties:
        assets:
          type: integer
          format: int64
          description: 입주 후 예상 자산 (원)
        monthlyExpenses:
          type: integer
          format: int64
          description: 입주 후 예상 월지출 (원)
        monthlyIncome:
          type: integer
          format: int64
          description: 월소득 (원)
        availableFunds:
          type: integer
          format: int64
          description: 월 여유자금 (원)

    CalculationResultResponse:
      type: object
      properties:
        id:
          type: string
          description: 계산 결과 ID
        userId:
          type: string
          description: 사용자 ID
        housingId:
          type: string
          description: 주택 ID
        housingName:
          type: string
          description: 주택 이름
        loanProductId:
          type: string
          description: 대출상품 ID
        loanProductName:
          type: string
          description: 대출상품 이름
        calculatedAt:
          type: string
          format: date-time
          description: 계산 일시
        financialStatus:
          $ref: '#/components/schemas/FinancialStatus'
        loanAnalysis:
          $ref: '#/components/schemas/LoanAnalysis'
        afterMoveIn:
          $ref: '#/components/schemas/AfterMoveIn'
        status:
          type: string
          enum: [ELIGIBLE, INELIGIBLE]
          description: 대출 가능 여부

    CalculationResultListItem:
      type: object
      properties:
        id:
          type: string
        housingName:
          type: string
        loanProductName:
          type: string
        calculatedAt:
          type: string
          format: date-time
        status:
          type: string
          enum: [ELIGIBLE, INELIGIBLE]
        availableFunds:
          type: integer
          format: int64
          description: 월 여유자금

    ErrorResponse:
      type: object
      properties:
        code:
          type: string
          description: 에러 코드
        message:
          type: string
          description: 에러 메시지
        timestamp:
          type: string
          format: date-time

  responses:
    BadRequest:
      description: 잘못된 요청
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: "INVALID_REQUEST"
            message: "입력 데이터가 올바르지 않습니다"
            timestamp: "2024-12-20T15:30:00Z"

    Unauthorized:
      description: 인증 실패
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: "UNAUTHORIZED"
            message: "인증이 필요합니다"
            timestamp: "2024-12-20T15:30:00Z"

    NotFound:
      description: 리소스를 찾을 수 없음
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          example:
            code: "NOT_FOUND"
            message: "계산 결과를 찾을 수 없습니다"
            timestamp: "2024-12-20T15:30:00Z"
